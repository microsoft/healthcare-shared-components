parameters:
  publishSymbols: false

steps:
  # Package NuGet Packages
  - task: DotNetCoreCLI@2
    displayName: 'dotnet pack'
    inputs:
      command: pack
      configuration: '$(buildConfiguration)'
      packDirectory: '$(build.artifactStagingDirectory)/nupkgs'
      versioningScheme: 'byEnvVar'
      versionEnvVar: 'nuget_version'
      nobuild: true
      zipAfterPublish: true
    env:
      nuget_version: $(nuGetVersion)

  # Publish Artifacts
  - publish: '$(build.artifactStagingDirectory)/nupkgs'
    artifact: 'nuget'

  - task: PublishSymbols@2
    displayName: 'Publish Symbols'
    condition: eq(parameters.publishSymbols, 'true')
    inputs:
      symbolsFolder: '$(build.sourcesDirectory)'
      searchPattern: '**/bin/**/*.pdb'
      symbolServerType: 'TeamServices'
      indexSources: false # done in build step
